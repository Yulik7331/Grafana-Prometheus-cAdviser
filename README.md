# üìä –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–ª–Ω–æ–≥–æ —Å—Ç–µ–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞: **Grafana + Prometheus + Node Exporter + cAdvisor + Alertmanager**

## üéØ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤ —Å–µ—Ä–≤–µ—Ä–æ–≤ (CPU, RAM, Disk, Network)
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- ‚úÖ –ê–ª–µ—Ä—Ç—ã –≤ Telegram
- ‚úÖ –ö—Ä–∞—Å–∏–≤—ã–µ –¥–∞—à–±–æ—Ä–¥—ã –≤ Grafana
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Ubuntu/Debian/CentOS/RHEL
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ –æ–¥–∏–Ω –∫–ª–∏–∫

---

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Linux —Å–µ—Ä–≤–µ—Ä (Ubuntu/Debian/CentOS/RHEL)
- Root –¥–æ—Å—Ç—É–ø (sudo)
- –ò–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
- –û—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ—Ä—Ç—ã (—Å–∫—Ä–∏–ø—Ç –ø–æ–¥—Å–∫–∞–∂–µ—Ç –∫–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å firewall)

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –°–∫–∞—á–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç

```bash
# –°–∫–∞—á–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –Ω–∞ –≤–∞—à —Å–µ—Ä–≤–µ—Ä
wget https://github.com/Yulik7331/Grafana-Prometheus-cAdvisor/blob/main/monitoring_setup_script.sh

# –ò–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –≤—Ä—É—á–Ω—É—é
nano monitoring_setup.sh
# –í—Å—Ç–∞–≤—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–∫—Ä–∏–ø—Ç–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ (Ctrl+X, Y, Enter)
```

### 2. –°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º

```bash
chmod +x monitoring_setup.sh
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç

```bash
sudo ./monitoring_setup.sh
```

---

## üìñ –ü–æ—à–∞–≥–æ–≤–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –û–¥–∏–Ω –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä + –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä–æ–≤ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

#### –ù–∞ –æ—Å–Ω–æ–≤–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ (–≥–¥–µ –±—É–¥–µ—Ç Grafana):

```bash
sudo ./monitoring_setup.sh
# –í—ã–±–µ—Ä–∏—Ç–µ: 1 - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
# –í–≤–µ–¥–∏—Ç–µ –ø–æ—Ä—Ç—ã (–∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
# –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- Prometheus –Ω–∞ –ø–æ—Ä—Ç—É `9091`
- Grafana –Ω–∞ –ø–æ—Ä—Ç—É `3002`
- –î–æ—Å—Ç—É–ø –∫ Grafana: `http://–í–ê–®_IP:3002`
  - –õ–æ–≥–∏–Ω: `admin`
  - –ü–∞—Ä–æ–ª—å: `admin`

#### –ù–∞ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–µ—Ä–µ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:

```bash
sudo ./monitoring_setup.sh
# –í—ã–±–µ—Ä–∏—Ç–µ: 2 - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–≥–µ–Ω—Ç—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä
# –í–≤–µ–¥–∏—Ç–µ –ø–æ—Ä—Ç –¥–ª—è cAdvisor (–∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ 9101)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- Node Exporter –Ω–∞ –ø–æ—Ä—Ç—É `9100`
- cAdvisor –Ω–∞ –ø–æ—Ä—Ç—É `9101`

#### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–æ–≤ –≤ Prometheus:

```bash
# –ù–∞ –æ—Å–Ω–æ–≤–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ
sudo ./monitoring_setup.sh
# –í—ã–±–µ—Ä–∏—Ç–µ: 5 - –î–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
# –í–≤–µ–¥–∏—Ç–µ IP –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞: 92.38.34.113
# –í–≤–µ–¥–∏—Ç–µ –∏–º—è —Å–µ—Ä–≤–µ—Ä–∞: server106
# –ï—Å—Ç—å Docker? (y/n): y
```

–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤.

---

## üîî –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤ –≤ Telegram

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ Telegram –±–æ—Ç–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram –∏ –Ω–∞–π–¥–∏—Ç–µ **@BotFather**
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/newbot`
3. –ü—Ä–∏–¥—É–º–∞–π—Ç–µ –∏–º—è –±–æ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: `My Monitoring Bot`)
4. –ü—Ä–∏–¥—É–º–∞–π—Ç–µ username (–Ω–∞–ø—Ä–∏–º–µ—Ä: `mymonitoring_bot`)
5. –ü–æ–ª—É—á–∏—Ç–µ **Bot Token**: `1234567890:ABCdefGHIjklMNOpqrsTUVwxyz`

### –®–∞–≥ 2: –ü–æ–ª—É—á–µ–Ω–∏–µ Chat ID

1. –ù–∞–π–¥–∏—Ç–µ –±–æ—Ç–∞ **@userinfobot** –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start`
3. –ë–æ—Ç –≤–µ—Ä–Ω—ë—Ç –≤–∞—à **Chat ID**: `123456789`

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Alertmanager

```bash
sudo ./monitoring_setup.sh
# –í—ã–±–µ—Ä–∏—Ç–µ: 9 - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –≤ Telegram
# –í–≤–µ–¥–∏—Ç–µ Bot Token: 1234567890:ABCdefGHIjklMNOpqrsTUVwxyz
# –í–≤–µ–¥–∏—Ç–µ Chat ID: 123456789
```

### –®–∞–≥ 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
sudo ./monitoring_setup.sh
# –í—ã–±–µ—Ä–∏—Ç–µ: 10 - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∞–ª–µ—Ä—Ç
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Telegram - –¥–æ–ª–∂–Ω–æ –ø—Ä–∏–π—Ç–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ
```

---

## üìä –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Grafana

### 1. –í–æ–π–¥–∏—Ç–µ –≤ Grafana

–û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä: `http://–í–ê–®_IP:3002`
- –õ–æ–≥–∏–Ω: `admin`
- –ü–∞—Ä–æ–ª—å: `admin`
- –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–ø—Ä–æ—Å–∏—Ç —Å–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å

### 2. –î–æ–±–∞–≤—å—Ç–µ Prometheus –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö

1. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ **‚öô Configuration** ‚Üí **Data Sources**
2. –ù–∞–∂–º–∏—Ç–µ **Add data source**
3. –í—ã–±–µ—Ä–∏—Ç–µ **Prometheus**
4. –í –ø–æ–ª–µ **URL** –≤–≤–µ–¥–∏—Ç–µ: `http://localhost:9090`
5. –ù–∞–∂–º–∏—Ç–µ **Save & Test**

### 3. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –¥–∞—à–±–æ—Ä–¥—ã

#### –î–∞—à–±–æ—Ä–¥ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤:

1. –ù–∞–∂–º–∏—Ç–µ **+** ‚Üí **Import**
2. –í–≤–µ–¥–∏—Ç–µ ID –¥–∞—à–±–æ—Ä–¥–∞: `1860`
3. –ù–∞–∂–º–∏—Ç–µ **Load**
4. –í—ã–±–µ—Ä–∏—Ç–µ Prometheus –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö
5. –ù–∞–∂–º–∏—Ç–µ **Import**

#### –î–∞—à–±–æ—Ä–¥ –¥–ª—è Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:

1. –ù–∞–∂–º–∏—Ç–µ **+** ‚Üí **Import**
2. –í–≤–µ–¥–∏—Ç–µ ID –¥–∞—à–±–æ—Ä–¥–∞: `893`
3. –ù–∞–∂–º–∏—Ç–µ **Load**
4. –í—ã–±–µ—Ä–∏—Ç–µ Prometheus –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö
5. –ù–∞–∂–º–∏—Ç–µ **Import**

### 4. –ì–æ—Ç–æ–≤–æ! üéâ

–¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å –∫—Ä–∞—Å–∏–≤—ã–µ –¥–∞—à–±–æ—Ä–¥—ã —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤!

---

## üîß –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ—Ä—Ç–æ–≤

| –°–µ—Ä–≤–∏—Å | –ü–æ—Ä—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|------|----------|
| Grafana | 3002 | –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ |
| Prometheus | 9091 | –°–µ—Ä–≤–µ—Ä —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫ |
| Alertmanager | 9093 | –°–∏—Å—Ç–µ–º–∞ –∞–ª–µ—Ä—Ç–æ–≤ |
| Node Exporter | 9100 | –ú–µ—Ç—Ä–∏–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ (–Ω–∞ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–µ—Ä–µ) |
| cAdvisor | 9101 | –ú–µ—Ç—Ä–∏–∫–∏ Docker (–Ω–∞ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–µ—Ä–µ) |

---

## üìÅ –í–∞–∂–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

```
/opt/monitoring/
‚îú‚îÄ‚îÄ prometheus/
‚îÇ   ‚îú‚îÄ‚îÄ prometheus.yml          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Prometheus
‚îÇ   ‚îî‚îÄ‚îÄ alerts.yml              # –ü—Ä–∞–≤–∏–ª–∞ –∞–ª–µ—Ä—Ç–æ–≤
‚îú‚îÄ‚îÄ grafana/                    # –î–∞–Ω–Ω—ã–µ Grafana
‚îî‚îÄ‚îÄ alertmanager/
    ‚îî‚îÄ‚îÄ alertmanager.yml        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Alertmanager
```

---

## üõ† –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
sudo ./monitoring_setup.sh
# –í—ã–±–µ—Ä–∏—Ç–µ: 6 - –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é:

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker ps -a

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker logs prometheus
docker logs grafana
docker logs node_exporter
docker logs cadvisor
docker logs alertmanager
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
sudo ./monitoring_setup.sh
# –í—ã–±–µ—Ä–∏—Ç–µ: 7 - –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é:

```bash
docker restart prometheus
docker restart grafana
docker restart node_exporter
docker restart cadvisor
docker restart alertmanager
```

### –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Prometheus

```bash
nano /opt/monitoring/prometheus/prometheus.yml
# –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:
docker restart prometheus
```

### –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –∞–ª–µ—Ä—Ç–æ–≤

```bash
nano /opt/monitoring/prometheus/alerts.yml
# –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:
docker restart prometheus
```

---

## üî• –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Firewall

### Ubuntu/Debian (UFW)

```bash
sudo ufw allow 9100/tcp   # Node Exporter
sudo ufw allow 9101/tcp   # cAdvisor
sudo ufw allow 9091/tcp   # Prometheus
sudo ufw allow 9093/tcp   # Alertmanager
sudo ufw allow 3002/tcp   # Grafana
```

### CentOS/RHEL (firewalld)

```bash
sudo firewall-cmd --permanent --add-port=9100/tcp
sudo firewall-cmd --permanent --add-port=9101/tcp
sudo firewall-cmd --permanent --add-port=9091/tcp
sudo firewall-cmd --permanent --add-port=9093/tcp
sudo firewall-cmd --permanent --add-port=3002/tcp
sudo firewall-cmd --reload
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç:

```bash
sudo ./monitoring_setup.sh
# –í—ã–±–µ—Ä–∏—Ç–µ: 8 - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å firewall
```

---

## üö® –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤

–ê–ª–µ—Ä—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ Alertmanager. –û–Ω–∏ –≤–∫–ª—é—á–∞—é—Ç:

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∞–ª–µ—Ä—Ç—ã (üî¥ Critical):
- –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –±–æ–ª–µ–µ 1 –º–∏–Ω—É—Ç—ã
- CPU > 95% –±–æ–ª–µ–µ 3 –º–∏–Ω—É—Ç
- RAM > 95% –±–æ–ª–µ–µ 3 –º–∏–Ω—É—Ç
- –î–∏—Å–∫ > 90% –±–æ–ª–µ–µ 3 –º–∏–Ω—É—Ç

### –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (‚ö†Ô∏è Warning):
- CPU > 80% –±–æ–ª–µ–µ 5 –º–∏–Ω—É—Ç
- RAM > 80% –±–æ–ª–µ–µ 5 –º–∏–Ω—É—Ç
- –î–∏—Å–∫ > 80% –±–æ–ª–µ–µ 5 –º–∏–Ω—É—Ç
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–Ω–æ–≥–æ —Ä–µ—Å—É—Ä—Å–æ–≤
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ—Ä–æ–≥–æ–≤

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏:

```bash
nano /opt/monitoring/prometheus/alerts.yml
```

–ü—Ä–∏–º–µ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ä–æ–≥–∞ CPU:

```yaml
- alert: HighCPUUsage
  expr: 100 - (avg by(instance, nodename) (rate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) > 70  # –ë—ã–ª–æ 80
  for: 5m
```

–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:

```bash
docker restart prometheus
```

---

## üì± –ü—Ä–∏–º–µ—Ä—ã –∞–ª–µ—Ä—Ç–æ–≤ –≤ Telegram

```
üî¥ CRITICAL

Alert: CriticalMemoryUsage
Severity: critical
Instance: 92.38.34.112 (server105)
Description: server105 (92.38.34.112) - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏: 96.5%
Time: 2025-10-08 14:30:22
```

```
‚ö†Ô∏è WARNING

Alert: HighDiskUsage
Severity: warning
Instance: 92.38.34.113 (server106)
Description: server106 (92.38.34.113) - –º–∞–ª–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ /: 85.2%
Time: 2025-10-08 15:45:10
```

---

## ‚ùì –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker logs prometheus
docker logs grafana

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤
netstat -tulnp | grep -E "9090|9091|3002"
```

### Grafana –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Prometheus –¥–æ—Å—Ç—É–ø–µ–Ω: `http://–í–ê–®_IP:9091`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ targets –≤ Prometheus: `http://–í–ê–®_IP:9091/targets`
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ targets –≤ —Å—Ç–∞—Ç—É—Å–µ **UP**

### –ê–ª–µ—Ä—Ç—ã –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ Telegram

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Alertmanager
docker logs alertmanager

# –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –∞–ª–µ—Ä—Ç
sudo ./monitoring_setup.sh
# –í—ã–±–µ—Ä–∏—Ç–µ: 10 - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∞–ª–µ—Ä—Ç
```

### Node Exporter –Ω–µ —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
curl http://localhost:9100/metrics

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker logs node_exporter

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ
docker restart node_exporter
```

---

## üìà –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# 1. –ù–∞ –Ω–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∞–≥–µ–Ω—Ç—ã
sudo ./monitoring_setup.sh
# –í—ã–±–µ—Ä–∏—Ç–µ: 2

# 2. –ù–∞ –æ—Å–Ω–æ–≤–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ –¥–æ–±–∞–≤—å—Ç–µ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
sudo ./monitoring_setup.sh
# –í—ã–±–µ—Ä–∏—Ç–µ: 5
```

### –ú–∞—Å—Å–æ–≤–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å–µ—Ä–≤–µ—Ä–æ–≤

–°–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏:

```bash
#!/bin/bash
# deploy_monitoring.sh

SERVERS=(
  "92.38.34.12:server001"
  "92.38.34.13:server002"
  "92.38.34.14:server003"
)

for server in "${SERVERS[@]}"; do
  IP="${server%%:*}"
  NAME="${server##*:}"
  
  echo "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ $NAME ($IP)..."
  
  # –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞
  scp monitoring_setup.sh root@$IP:/tmp/
  
  # –£—Å—Ç–∞–Ω–æ–≤–∫–∞
  ssh root@$IP "cd /tmp && chmod +x monitoring_setup.sh && echo '2' | ./monitoring_setup.sh"
  
  echo "–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ Prometheus..."
  # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
  # ... –≤–∞—à –∫–æ–¥ ...
done
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. **–ò–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å Grafana** –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞
2. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø** –∫ –ø–æ—Ä—Ç–∞–º —á–µ—Ä–µ–∑ firewall
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ VPN** –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ Grafana
4. **–†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ** –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:

```bash
docker pull prom/prometheus:latest
docker pull grafana/grafana:latest
docker pull prom/node-exporter:latest
docker pull gcr.io/cadvisor/cadvisor:latest
docker pull prom/alertmanager:latest

# –ó–∞—Ç–µ–º –ø–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç
```

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

### –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏:

- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Prometheus](https://prometheus.io/docs/)
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Grafana](https://grafana.com/docs/)
- [–î–∞—à–±–æ—Ä–¥—ã Grafana](https://grafana.com/grafana/dashboards/)
- [Node Exporter](https://github.com/prometheus/node_exporter)
- [cAdvisor](https://github.com/google/cadvisor)

### –õ–æ–≥–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:

```bash
# –í—Å–µ –ª–æ–≥–∏
docker logs prometheus
docker logs grafana
docker logs node_exporter
docker logs cadvisor
docker logs alertmanager

# –°–ª–µ–¥–∏—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker logs -f prometheus
```

---

## üéì –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL –¥–ª—è Grafana

```bash
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ nginx –∫–∞–∫ reverse proxy
# –ò–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π SSL –≤ Grafana
```

### –î–ª–∏—Ç–µ–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é Prometheus —Ö—Ä–∞–Ω–∏—Ç –º–µ—Ç—Ä–∏–∫–∏ 15 –¥–Ω–µ–π. –î–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è:

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Prometheus
docker stop prometheus

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º retention
docker run -d \
  --name=prometheus \
  --restart=always \
  -p 9091:9090 \
  -v /opt/monitoring/prometheus:/etc/prometheus \
  prom/prometheus:latest \
  --config.file=/etc/prometheus/prometheus.yml \
  --storage.tsdb.retention.time=90d
```

### –≠–∫—Å–ø–æ—Ä—Ç –º–µ—Ç—Ä–∏–∫ –≤ –¥—Ä—É–≥–∏–µ —Å–∏—Å—Ç–µ–º—ã

Prometheus –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç remote write –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤:
- InfluxDB
- Thanos
- VictoriaMetrics
- –ò –¥—Ä—É–≥–∏–µ

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

- [ ] Prometheus –¥–æ—Å—Ç—É–ø–µ–Ω –∏ —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏
- [ ] Grafana –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∞—à–±–æ—Ä–¥—ã
- [ ] –í—Å–µ —Å–µ—Ä–≤–µ—Ä—ã –≤ —Å—Ç–∞—Ç—É—Å–µ UP –≤ Prometheus Targets
- [ ] –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –¥–∞—à–±–æ—Ä–¥—ã 1860 –∏ 893
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –∞–ª–µ—Ä—Ç—ã –≤ Telegram
- [ ] –ü–æ–ª—É—á–µ–Ω —Ç–µ—Å—Ç–æ–≤—ã–π –∞–ª–µ—Ä—Ç –≤ Telegram
- [ ] Firewall –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –ü–∞—Ä–æ–ª—å Grafana –∏–∑–º–µ–Ω—ë–Ω

---

## üìù Changelog

**v1.0** - –ü–µ—Ä–≤–∞—è –≤–µ—Ä—Å–∏—è
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Grafana + Prometheus
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Node Exporter –∏ cAdvisor
- –ê–ª–µ—Ä—Ç—ã –≤ Telegram
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ–Ω—é

---

**–£–¥–∞—á–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞! üöÄüìä**
